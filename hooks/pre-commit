#! /bin/bash

# This runs before every commit to version control

# Pre commit checks for clients
echo "Pre commit checks running..."

# Only run if package.json is staged for this commit
if ! git diff --name-only --cached | grep -qx "package.json"; then
  echo "[pre-commit] package.json not staged; skipping version reminder."
  exit 0
fi

# jq is needed to read JSON
if ! command -v jq >/dev/null 2>&1; then
  echo "[pre-commit] jq not found; skipping version reminder."
  exit 0
fi

# If repo has no commits yet, skip
if ! git rev-parse --verify HEAD >/dev/null 2>&1; then
  echo "[pre-commit] No commits yet; skipping version reminder."
  exit 0
fi

OLD_VERSION=$(git show HEAD:package.json 2>/dev/null | jq -r .version || echo "")
NEW_VERSION=$(git show :package.json 2>/dev/null | jq -r .version || echo "")

# If version unchanged, just remind (do not block)
if [[ -n "$OLD_VERSION" && -n "$NEW_VERSION" && "$OLD_VERSION" == "$NEW_VERSION" ]]; then
  echo "[pre-commit] package.json is staged but version did not change (still $NEW_VERSION)."
  exit 0
fi

echo "âœ“ Pre commit checks passed"

exit 0
